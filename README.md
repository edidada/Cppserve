# C++webæ¡†æ¶

### ç®€ä»‹

é¡¹ç›®åœ°å€ï¼šhttps://github.com/charmber/Cppserve  éº»çƒ¦ç‚¹ä¸ªå°ğŸŒŸ

ç›®å‰æ¡†æ¶å‡†å¤‡å–åä¸ºchamberï¼Œå…·ä½“åŠŸèƒ½æ­£åœ¨é€æ¸å®Œå–„ï¼Œå¦‚æœ‰æ”¹è¿›æˆ–è€…æè®®çš„åœ°æ–¹æ¬¢è¿æŒ‡å¯¼

åç»­å°†ä¼šæ¨å‡ºè¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼Œä»¥åŠå¤´æ–‡ä»¶å¼•å…¥æ•™ç¨‹ï¼Œç›®å‰æ”¯æŒä½¿ç”¨æ–¹å¼
1.ç›´æ¥å¼•å…¥å¤´æ–‡ä»¶`chamber.h`
```sh
clang++ main.cpp -lmysqlclient
```
2.ä½¿ç”¨CMakeLists.txtå¼•å…¥ç›´æ¥æ„å»º

### æ–‡ä»¶ç»“æ„

```
----basedata
    ---src      æ•°æ®åº“æºæ–‡ä»¶
    ---corm.h   æ•°æ®åº“å£°æ˜å¤´æ–‡ä»¶
----http        //tcpè¯·æ±‚å“åº”é€»è¾‘éƒ¨åˆ†
	---httpheader.h
	---httpserve.h
	âŒ™--router
	    ---router.h
----str        //å­—ç¬¦ä¸²ä»¥åŠjsonåºåˆ—åŒ–å’Œååºåˆ—åŒ–
	---json.h
----test       //æ¡†æ¶æµ‹è¯•ä»£ç 
        ---controller
        ---router.cpp
        ---main.cpp
Cmdouble.h
```

**æ–‡ä»¶ç›®å½•ï¼š**

- **http**ï¼šè¯¥ç›®å½•ä¸ºå­˜æ”¾ç½‘ç»œé€šè¡Œå»ºç«‹ä»¥åŠè·¯ç”±é€‰æ‹©ä¹‹ç±»åŠŸèƒ½ç›®å½•
- **router**ï¼šè¯¥ç›®å½•ä¸ºè¿›è¡Œè·¯ç”±é€‰æ‹©ç­‰åŠŸèƒ½å¤„ç†ç›®å½•
- **str**ï¼šè¯¥ç›®å½•ä¸ºå­—ç¬¦ä¸²ç›¸å…³å¤„ç†ç›®å½•
- **basedata**:è¯¥ç›®å½•ä¸ºæ•°æ®åº“ç›¸å…³ç›®å½•
- **test**ï¼šè¯¥ç›®å½•ä¸ºæ¡†æ¶æµ‹è¯•ä»£ç 

**æ–‡ä»¶åï¼š**

- **httpheader.h**:å¤„ç†httpè¯·æ±‚å¤´éƒ¨ä»¥åŠå“åº”è§£æç­‰å‡½æ•°
- **httpserve.h**:å¤„ç†httpé€šä¿¡æœåŠ¡ç›¸å…³å·¥ä½œ
- **router.h**:å¤„ç†urlè§£æç­‰å·¥ä½œ
- **json.h**:å¤„ç†jsonæ ¼å¼åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œ
- **Cmdoble.h**:c++æ ‡å‡†åº“å¤´æ–‡ä»¶å­˜æ”¾æ–‡ä»¶

### æ”¯æŒè·¯ç”±åˆ†å‘åŠŸèƒ½

é€šè¿‡routerå¯¹è±¡è°ƒç”¨AddUrlæ–¹æ³•å³å¯æ·»åŠ ä¸åŒè·¯ç”±å¯¹åº”å¤„ç†çš„ä¸šåŠ¡é€»è¾‘å‡½æ•°

### å¢åŠ çº¿ç¨‹æ± åŠŸèƒ½ï¼š

å¯é€‰æ‹©æ˜¯å¦ä½¿ç”¨å¤šçº¿ç¨‹åŠŸèƒ½ï¼Œåœ¨åˆ›å»ºè·¯ç”±å‡½æ•°æ—¶å€™ä¼ å…¥åˆ›å»ºçº¿ç¨‹å¯¹è±¡
å¤šçº¿ç¨‹ä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹æ± è¿›è¡Œç®¡ç†ï¼Œå®ç°äº†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—å¯¹ä»»åŠ¡è¿›è¡Œå¤„ç†
æ˜æ˜¾æé«˜äº†ioè¯·æ±‚çš„å¹¶å‘èƒ½åŠ›ï¼Œ

### å¢åŠ epollå¤šè·¯å¤ç”¨-è¾¹ç¼˜(ET)éé˜»å¡æ¨¡å¼

### æ€§èƒ½æµ‹è¯•ç»“æœ

![](https://charmber-image-bed.oss-cn-shanghai.aliyuncs.com/20230316145927.png)

åœ¨å¹¶å‘é‡ä¸º4570çš„æƒ…å†µä¸‹ä¹Ÿèƒ½ç¨³å®šå…¨éƒ¨è¯·æ±‚æˆåŠŸ,å¹¶ä¸”æ¯åˆ†é’Ÿå¹¶å‘é‡è¾¾åˆ°54ä¸‡ï¼ŒQBSå¯ä»¥è¾¾åˆ°ä¸Šä¸‡æ¬¡ï¼Œ10304/s
(æ­¤å¹¶å‘é‡è¯·æ±‚å…¨éƒ¨æˆåŠŸæ²¡æœ‰å»¶è¿Ÿï¼Œå› æ­¤è¿˜æ²¡æœ‰è¾¾åˆ°æœ€å¤§æ€§èƒ½ï¼Œæˆ‘çš„æµ‹è¯•æœºæ˜¯è™šæ‹Ÿæœºï¼Œç›®å‰åªèƒ½è¾¾åˆ°è¿™ä¸ªè¯·æ±‚æ•°)

### å¢åŠ æ•°æ®åº“curdç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒé¢å‘å¯¹è±¡å¼ä¼ å‚ä½¿ç”¨ï¼Œä¸åœ¨ä¾é SQLè¯­å¥

![](https://charmber-image-bed.oss-cn-shanghai.aliyuncs.com/20230316111938.png)

#### è·¯ç”±ç›¸å…³api
å®ç°ç±»ä¸ºrouterï¼Œ
ä¾‹å¦‚æ·»åŠ ä¸€ä¸ªhttpè¯·æ±‚ï¼š
```c++
//æ·»åŠ GETè¯·æ±‚
    router.Get("index",test);   //ç¬¬äºŒä¸ªå‚æ•°å³ä¸ºè°ƒç”¨æ¥å£
//æ·»åŠ POSTè¯·æ±‚
    router.POST("login",login);
```

ç„¶åå³å¯å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼š
```c++
//åˆ›å»ºä¸€ä¸ªæœåŠ¡å¯¹è±¡ï¼Œä¼ å…¥éœ€è¦å¼€å¯çš„ç«¯å£å·ï¼Œè°ƒç”¨runå³å¯
int main()
{
    chamber c(8080);
    c.run();
    return 0;
}
```
å¦‚æœéœ€è¦å¼€å¯å¤šçº¿ç¨‹åˆ™éœ€è¦è°ƒç”¨è·¯ç”±å¯¹è±¡æ–¹æ³•ä»¥åŠåˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡
```c++
int main()
{
    ThreadPool pool(8);     //é€‰æ‹©éœ€è¦å¼€å¯çš„æœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œé»˜è®¤ä¸º4ä¸ª
    pool.init();
    router.StartThreadPool(&pool);
    RouterManage();
    chamber c(8080);
    c.run();
    return 0;
}
```

è°ƒç”¨æ¥å£å‡½æ•°å“åº”æ—¶å€™åˆ™å¯ä»¥
```c++
//ä¼ å…¥ä¸€ä¸ªHeaderå¯¹è±¡ï¼Œå°è£…jsonæˆå­—ç¬¦ä¸²ä¼ å…¥SendRequestHeaderï¼Œä»¥åŠé€‰æ‹©å“åº”çŠ¶æ€ç å³å¯
void test(Header hea){
    ChJson te;
    te["æµ‹è¯•"]="æˆåŠŸ";
    te["æµ‹è¯•2"]="å“ˆå“ˆå“ˆ";
    std::string st= Json(te);
    hea.SendRequestHeader(200,st);
}
```

ä½¿ç”¨SQLæ“ä½œæ•°æ®åº“å¯ä»¥
```c++

    c.InitMysql("127.0.0.1", "root", "131420", "test", 3306);
    c.ConditionSearch("user", "age>=", "15", "name", "age");
    c.GetResult();
    
    std::unordered_map<std::string,std::string> tmp={
        {"name","æµ‹è¯•"},
        {"age","33"},
        {"number","11445566"},
        {"ID","8"}
    };
    c.InsertData("user",tmp);

    c.CloseMysql();
```
æœ€ç»ˆæ•ˆæœï¼š
![](https://charmber-image-bed.oss-cn-shanghai.aliyuncs.com/20230316142102.png)

å¢åŠ äº†ç‚«é…·çš„å¯åŠ¨ç‰¹æ•ˆå­—ä½“ä»¥åŠè¯·æ±‚å“åº”æç¤ºé¢œè‰²èƒŒæ™¯
æ•ˆæœå¦‚ä¸‹ï¼š
![](https://charmber-image-bed.oss-cn-shanghai.aliyuncs.com/20230420104333.png)
